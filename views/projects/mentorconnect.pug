extends ../layout

append scripts
	script(src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js")
	script(src="https://rawgit.com/allenhwkim/angularjs-google-maps/master/build/scripts/ng-map.js")
	script.
		app = angular.module('myApp', ['ngMap']);
		app.controller('myCtrl', ['$scope','$http', 'NgMap', function($scope,$http,NgMap) {
			$scope.submit = function() {
				return $http.post('/projects/mentorconnect/contacts', {name:$scope.name, city:$scope.city, contact:$scope.contact, virtual:$scope.virtual}).then(function successCallback(response) {$scope.refreshMap();}, function errorCallback(response) {});
			};

			$scope.googleMapsUrl="https://maps.googleapis.com/maps/api/js?key=AIzaSyDCil4faNpZbfPn9DI-fYqJ01qYnvVeN4c";


			$scope.refreshMap = function() {
				var mentors;
				$http.get('/projects/mentorconnect/contacts').then(function successCallback(response) {
						mentors = response;
						NgMap.getMap().then(function(map) {
							var geocoder = new google.maps.Geocoder();
							for (index in mentors.data) {

								geocoder.geocode({'address': mentors.data[index].city}, function (results, status) {
									if (status == 'OK') {
										var marker = new google.maps.Marker({
											position: results[0].geometry.location,
											map: map,
											title: 'Hello World!'
										});
									} 
								});
							}
						});
					},
					function errorCallback(response) {
						console.log(response);
						mentors = null;
					}
				);
			};

			$scope.refreshMap();
		}]);

block active
	- submenu = 'Projects';
	- active = 'Mentor Connection';

append body
	body(ng-app='myApp')
	.container
	.starter-template
		h1 Mentor Connection
		h3 I want to mentor
		div(ng-controller='myCtrl')
			input(type='radio' name='virtualMentor' ng-model="virtual" value="either") 
			|  I can mentor remotely or in person
			br
			input(type='radio' name='virtualMentor' ng-model="virtual" value="virtual")
			|  I only want to mentor remotely
			br
			input(type='radio' name='virtualMentor' ng-model="virtual" value="person") 
			|  I only want to mentor in person
			br
			br
			p Name:
			input(type='text' name='name' ng-model="name")
			br
			br
			p City:
			input(type='text' name='city' ng-model="city")
			br
			br
			p Contact Info:
			input(type='text' name='contact' ng-model="contact")
			br
			br
			button(ng-click='submit()' value='Submit') Submit!
			br
			h3 Existing Mentors: 
			br
			div(map-lazy-load="https://maps.google.com/maps/api/js" map-lazy-load-params="{{googleMapsUrl}}")
				ng-map(center="33.4484,-112.074" zoom="7" style="height:500px")
		br
		h3 I am looking for a mentor
		input(type='radio') 
		|  I want mentorship remotely or in person
		br
		input(type='radio')
		|  I only want mentorship remotely
		br
		input(type='radio') 
		|  I only want mentorship in person